@model E_Comm.Models.UserViewModel

@{
    ViewData["Title"] = "Create User";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="admin-content">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <div>
                <h1 class="page-title">
                    <i class="fas fa-user-plus"></i>
                    Create User
                </h1>
                <p class="page-subtitle">Add a new user to the system with proper validation</p>
            </div>
            <div>
                <a href="@Url.Action("ManageUsers", "Admin")" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Users
                </a>
            </div>
        </div>
    </div>

    <!-- Create User Form -->
    <div class="form-section">
        <form asp-action="CreateUser" method="post" class="needs-validation" novalidate>
            <div class="form-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-user me-2"></i>User Information
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Basic User Information -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label asp-for="UserName" class="form-label required">Username</label>
                            <input asp-for="UserName" class="form-control" placeholder="Enter username" required>
                            <span asp-validation-for="UserName" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Email" class="form-label required">Email Address</label>
                            <input asp-for="Email" type="email" class="form-control" placeholder="Enter email address" required>
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label asp-for="Name" class="form-label required">Full Name</label>
                            <input asp-for="Name" class="form-control" placeholder="Enter full name" required>
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="IsAdmin" class="form-label">User Role</label>
                            <select asp-for="IsAdmin" class="form-select" required>
                                <option value="">Select Role</option>
                                <option value="false">Customer</option>
                                <option value="true">Administrator</option>
                            </select>
                            <span asp-validation-for="IsAdmin" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Password Management -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="Password" class="form-label required">Password</label>
                            <input type="password" id="Password" name="Password" class="form-control" 
                                   placeholder="Enter secure password" required minlength="6">
                            <div class="form-text">Password must be at least 6 characters long</div>
                        </div>
                        <div class="form-group">
                            <label for="ConfirmPassword" class="form-label required">Confirm Password</label>
                            <input type="password" id="ConfirmPassword" name="ConfirmPassword" class="form-control" 
                                   placeholder="Confirm password" required>
                            <div class="form-text">Must match the password above</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Details Section -->
            <div class="form-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-address-card me-2"></i>Customer Details (Optional)
                    </h5>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="PhoneNumber" class="form-label">Phone Number</label>
                        <input type="tel" id="PhoneNumber" name="PhoneNumber" class="form-control" 
                               placeholder="e.g., +61 2 1234 5678">
                    </div>

                    <!-- Australian Address Section -->
                    <h6 class="mt-4 mb-3">
                        <i class="fas fa-map-marker-alt me-2"></i>Australian Address
                    </h6>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="StreetAddress" class="form-label">Street Address</label>
                            <input type="text" id="StreetAddress" name="StreetAddress" class="form-control" 
                                   placeholder="e.g., 123 Collins Street">
                            <div class="form-text">Must contain both letters and numbers</div>
                        </div>
                        <div class="form-group">
                            <label for="Suburb" class="form-label">Suburb</label>
                            <input type="text" id="Suburb" name="Suburb" class="form-control" 
                                   placeholder="e.g., Melbourne">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="State" class="form-label">State</label>
                            <select id="State" name="State" class="form-select">
                                <option value="">Select State</option>
                                <option value="NSW">New South Wales</option>
                                <option value="VIC">Victoria</option>
                                <option value="QLD">Queensland</option>
                                <option value="WA">Western Australia</option>
                                <option value="SA">South Australia</option>
                                <option value="TAS">Tasmania</option>
                                <option value="ACT">Australian Capital Territory</option>
                                <option value="NT">Northern Territory</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="PostCode" class="form-label">Postcode</label>
                            <input type="text" id="PostCode" name="PostCode" class="form-control" 
                                   placeholder="e.g., 3000" pattern="[0-9]{4}" maxlength="4">
                            <div class="form-text">Must be 4 digits only</div>
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <h6 class="mt-4 mb-3">
                        <i class="fas fa-credit-card me-2"></i>Payment Information (Optional)
                    </h6>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="CardNumber" class="form-label">Card Number</label>
                            <input type="text" id="CardNumber" name="CardNumber" class="form-control" 
                                   placeholder="**** **** **** ****">
                        </div>
                        <div class="form-group">
                            <label for="CardOwner" class="form-label">Card Owner</label>
                            <input type="text" id="CardOwner" name="CardOwner" class="form-control" 
                                   placeholder="Name on card">
                        </div>
                    </div>

                    <div class="form-grid-3">
                        <div class="form-group">
                            <label for="Expiry" class="form-label">Expiry Date</label>
                            <input type="text" id="Expiry" name="Expiry" class="form-control" 
                                   placeholder="MM/YY" pattern="[0-9]{2}/[0-9]{2}" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label for="CVV" class="form-label">CVV</label>
                            <input type="text" id="CVV" name="CVV" class="form-control" 
                                   placeholder="123" pattern="[0-9]{3,4}" maxlength="4">
                        </div>
                        <div class="form-group">
                            <!-- Spacer for grid alignment -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Create User
                </button>
                <a href="@Url.Action("ManageUsers", "Admin")" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        // Form validation
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('.needs-validation');
            
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                // Custom validation
                if (!validatePasswords()) {
                    event.preventDefault();
                }
                
                if (!validateAustralianAddress()) {
                    event.preventDefault();
                }
                
                form.classList.add('was-validated');
            });
            
            // Real-time password validation
            const password = document.getElementById('Password');
            const confirmPassword = document.getElementById('ConfirmPassword');
            
            confirmPassword.addEventListener('input', validatePasswords);
            
            function validatePasswords() {
                const isValid = password.value === confirmPassword.value;
                
                if (password.value && confirmPassword.value) {
                    if (isValid) {
                        confirmPassword.setCustomValidity('');
                        confirmPassword.classList.remove('is-invalid');
                    } else {
                        confirmPassword.setCustomValidity('Passwords do not match');
                        confirmPassword.classList.add('is-invalid');
                    }
                }
                
                return isValid;
            }
            
            // Australian address validation
            function validateAustralianAddress() {
                const streetAddress = document.getElementById('StreetAddress').value;
                const postCode = document.getElementById('PostCode').value;
                const state = document.getElementById('State').value;
                
                let isValid = true;
                
                // Validate street address (must contain both letters and numbers)
                if (streetAddress && !(/[a-zA-Z]/.test(streetAddress) && /[0-9]/.test(streetAddress))) {
                    document.getElementById('StreetAddress').setCustomValidity('Address must contain both letters and numbers');
                    isValid = false;
                } else {
                    document.getElementById('StreetAddress').setCustomValidity('');
                }
                
                // Validate postcode (must be 4 digits)
                if (postCode && !/^[0-9]{4}$/.test(postCode)) {
                    document.getElementById('PostCode').setCustomValidity('Postcode must be exactly 4 digits');
                    isValid = false;
                } else {
                    document.getElementById('PostCode').setCustomValidity('');
                }
                
                return isValid;
            }
            
            // Format card number
            document.getElementById('CardNumber').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                e.target.value = formattedValue;
            });
            
            // Format expiry date
            document.getElementById('Expiry').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
            });
        });
    </script>
} 